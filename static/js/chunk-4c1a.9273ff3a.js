(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4c1a"],{QO4p:function(e,t,i){"use strict";var a=i("wUZ+");i.n(a).a},kFvY:function(e,t,i){"use strict";i.r(t);var a,s=i("YEIV"),n=i.n(s),o=i("vDqi"),l=i.n(o),r=i("KTTK"),c=i("ViDN"),m=i("utuE"),u=i("1RnH"),d={components:{CreateView:c.a,membersDep:m.a,relatedBusiness:u.a},computed:{crmFileSaveUrl:function(){return window.BASE_URL+r.f},httpHeader:function(){return{authKey:l.a.defaults.headers.authKey,sessionId:l.a.defaults.headers.sessionId}}},data:function(){return{activeName:"1",tabsData:[{label:"日报",key:"1"},{label:"周报",key:"2"},{label:"月报",key:"3"}],formList:[],dateList:[{label:"今日工作内容",model:"content"},{label:"明日工作内容",model:"tomorrow"},{label:"遇到的问题",model:"question"}],weekList:[{label:"本周工作内容",model:"content"},{label:"下周工作内容",model:"tomorrow"},{label:"遇到的问题",model:"question"}],monthList:[{label:"本月工作内容",model:"content"},{label:"下月工作内容",model:"tomorrow"},{label:"遇到的问题",model:"question"}],imageFileList:[],fileList:[],dialogVisible:!1,relevanceAll:{},allData:{}}},props:{formData:{type:Object,default:function(){return{}}},dialogTitle:{type:String,default:"写日志"},accessoryFileList:{type:Array,default:function(){return[]}},imgFileList:{type:Array,default:function(){return[]}},newLoading:Boolean},mounted:function(){if(document.body.appendChild(this.$el),this.formList=this.dateList,this.formData.category_id)switch(this.formData.category_id){case 1:this.tabsData=[{label:"日报",key:"1"}],this.formList=this.dateList;break;case 2:this.tabsData=[{label:"周报",key:"1"}],this.formList=this.weekList;break;case 3:this.tabsData=[{label:"月报",key:"1"}],this.formList=this.monthList}var e={};e.business=this.formData.businessList?this.formData.businessList:[],e.contacts=this.formData.contactsList?this.formData.contactsList:[],e.contract=this.formData.contractList?this.formData.contractList:[],e.customer=this.formData.customerList?this.formData.customerList:[],this.allData=e;var t={};t.business_ids=this.formData.businessList?this.formData.businessList.map(function(e,t,i){return e.business_id}):[],t.contacts_ids=this.formData.contactsList?this.formData.contactsList.map(function(e,t,i){return e.contacts_id}):[],t.contract_ids=this.formData.contractList?this.formData.contractList.map(function(e,t,i){return e.contract_id}):[],t.customer_ids=this.formData.customerList?this.formData.customerList.map(function(e,t,i){return e.customer_id}):[],this.relevanceAll=t,this.imageFileList=this.imgFileList.map(function(e,t,i){return e.url=e.file_path_thumb,e}),this.fileList=this.accessoryFileList.map(function(e,t,i){return e.url=e.file_path_thumb,e})},methods:(a={close:function(){1==this.$route.query.routerKey?this.$router.go(-1):this.$emit("close")},tabClick:function(){switch(this.activeName){case"1":this.formList=this.dateList;break;case"2":this.formList=this.weekList;break;case"3":this.formList=this.monthList}},submitBtn:function(){this.formData.content||this.formData.tomorrow||this.formData.question?this.$emit("submitBtn",this.activeName,this.fileList,this.imageFileList,this.relevanceAll):this.$message.error("内容至少填写一项")},beforeRemove:function(){return this.$confirm("此操作将永久删除该图片, 是否继续？")},imgFileUploadSuccess:function(e,t,i){this.imageFileList=i},handleFilePreview:function(e){if(e.response||e.file_id){var t=void 0;t=e.response?{url:e.response.data[0].path,name:e.response.data[0].name}:{url:e.file_path,name:e.name},this.$bus.emit("preview-image-bus",{index:0,data:[t]})}}},n()(a,"beforeRemove",function(e,t){var i=this;if(e.response||e.file_id){var a=void 0;return a=e.response?e.response.data[0].save_name:e.save_name,this.$confirm("您确定要删除该文件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.c)({save_name:a}).then(function(e){i.$message.success(e.data);var t=i.getFileIndex(i.$refs.imageUpload.uploadFiles,a);-1!=t&&i.$refs.imageUpload.uploadFiles.splice(t,1),-1!=(t=i.getFileIndex(i.imgFileList,a))&&i.imgFileList.splice(t,1)}).catch(function(){})}).catch(function(){i.$message({type:"info",message:"已取消操作"})}),!1}return!0}),n()(a,"getFileIndex",function(e,t){for(var i=-1,a=0;a<e.length;a++){var s=e[a];if((s.response?s.response.data[0].save_name:s.save_name)==t){i=a;break}}return i}),n()(a,"fileUploadSuccess",function(e,t,i){this.fileList=i}),n()(a,"handleFileRemove",function(e,t){var i=this;if(e.response||e.file_id){var a=void 0;return a=e.response?e.response.data[0].save_name:e.save_name,this.$confirm("您确定要删除该文件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.c)({save_name:a}).then(function(e){i.$message.success(e.data);var t=i.getFileIndex(i.$refs.fileUpload.uploadFiles,a);-1!=t&&i.$refs.fileUpload.uploadFiles.splice(t,1),-1!=(t=i.getFileIndex(i.fileList,a))&&i.fileList.splice(t,1)}).catch(function(){})}).catch(function(){i.$message({type:"info",message:"已取消操作"})}),!1}return!0}),n()(a,"popoverSubmit",function(e,t){this.$set(this.formData,"sentWhoList",e),this.$set(this.formData,"depData",t)}),n()(a,"handleClose",function(){this.dialogVisible=!1}),n()(a,"checkInfos",function(e){this.relevanceAll=e}),a),destroyed:function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)}},h=(i("QO4p"),i("KHd+")),f=Object(h.a)(d,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("create-view",{attrs:{"body-style":{height:"100%"}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.newLoading,expression:"newLoading"}],staticClass:"new-journal"},[a("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"text"},[e._v(e._s(e.dialogTitle))]),e._v(" "),a("img",{staticClass:"el-icon-close rt",attrs:{src:i("cjwK"),alt:""},on:{click:e.close}})]),e._v(" "),a("div",{staticClass:"content"},[a("el-tabs",{on:{"tab-click":e.tabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabsData,function(e,t){return a("el-tab-pane",{key:t,attrs:{label:e.label,name:e.key}})})),e._v(" "),a("div",{staticClass:"form"},[e._l(e.formList,function(t,i){return a("div",{key:i,staticClass:"row-list"},[a("label",{staticClass:"item-label"},[e._v(e._s(t.label)+"：")]),e._v(" "),a("el-input",{attrs:{type:"textarea",autosize:{minRows:4},placeholder:"请输入内容",resize:"none"},model:{value:e.formData[t.model],callback:function(i){e.$set(e.formData,t.model,i)},expression:"formData[item.model]"}})],1)}),e._v(" "),a("div",{staticClass:"img-accessory"},[a("div",{staticClass:"img-box"},[a("el-upload",{ref:"imageUpload",attrs:{action:e.crmFileSaveUrl,headers:e.httpHeader,name:"img[]",multiple:"",accept:"image/*","list-type":"picture-card","on-preview":e.handleFilePreview,"before-remove":e.beforeRemove,"on-success":e.imgFileUploadSuccess,"file-list":e.imageFileList}},[a("p",{staticClass:"add-img"},[a("span",{staticClass:"el-icon-picture"}),e._v(" "),a("span",[e._v("添加图片")])]),e._v(" "),a("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),a("p",{staticClass:"add-accessory"},[a("el-upload",{ref:"fileUpload",attrs:{action:e.crmFileSaveUrl,headers:e.httpHeader,name:"file[]",multiple:"",accept:"*.*","on-preview":e.handleFilePreview,"before-remove":e.handleFileRemove,"on-success":e.fileUploadSuccess,"file-list":e.fileList}},[a("p",[a("img",{attrs:{src:i("6KEE"),alt:""}}),e._v("\n                添加附件\n              ")])])],1)]),e._v(" "),a("div",{staticClass:"sent-who"},[a("span",{staticClass:"label"},[e._v("发送给谁:")]),e._v(" "),e._l(e.formData.sentWhoList,function(t,i){return a("div",{directives:[{name:"photo",rawName:"v-photo",value:t,expression:"k"},{name:"lazy",rawName:"v-lazy:background-image",value:e.$options.filters.filterUserLazyImg(t.thumb_img),expression:"$options.filters.filterUserLazyImg(k.thumb_img)",arg:"background-image"}],key:i,staticClass:"div-photo k-img header-circle"})}),e._v(" "),a("span",e._l(e.formData.depData,function(t,i){return a("span",{key:i,staticClass:"item-name"},[e._v(e._s(t.name))])})),e._v(" "),a("members-dep",{attrs:{userCheckedData:e.formData.sentWhoList,depCheckedData:e.formData.depData,contentBlock:!1},on:{popoverSubmit:e.popoverSubmit}},[a("img",{staticClass:"sent-img",attrs:{slot:"membersDep",src:i("xVxq")},slot:"membersDep"})])],2),e._v(" "),a("related-business",{attrs:{marginLeft:"0",allData:e.allData},on:{checkInfos:e.checkInfos}})],2)],1),e._v(" "),a("div",{staticClass:"btn-group"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitBtn}},[e._v("提交")]),e._v(" "),a("el-button",{on:{click:e.close}},[e._v("取消")])],1)])])},[],!1,null,"f97b37ac",null);f.options.__file="newDialog.vue";t.default=f.exports},"wUZ+":function(e,t,i){},xVxq:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVCMjlGNEZDRTE2RDExRThBQkZGQkQwOUMwNEMwMzVBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjVCMjlGNEZERTE2RDExRThBQkZGQkQwOUMwNEMwMzVBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NUIyOUY0RkFFMTZEMTFFOEFCRkZCRDA5QzA0QzAzNUEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NUIyOUY0RkJFMTZEMTFFOEFCRkZCRDA5QzA0QzAzNUEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4W+9KDAAACUklEQVR42ryXv0sbYRjHL2eapWKaPyBL05RKhoCxhbbGLjWRirhI7NKpmyDqUOiYrnawpUi7OLVD6yQoaas4+SNDomMEm0qh7SAETFAQLMV+H/kevA05L29y3gMfDu7H88nlee7e53zFYtFoIq6ANBgAt8F1cI3HqmAfFMAq+Ar+OCU0HY5L8iz4BZ6B39zGQReJc596Tlb5Ydrix6AEwuA+eABmwCY4AKfkgPte8px7vKbEHA3D32BfB3gDBsEI/0KdKIOnLMkn0A8mwN+L7likC6Ab3GlBqkaBOWLM2XGR+BXoZCNVjPajwoa8Cl7bicd40ihr51acMudDOv4TSwfOgifgyHA/jpl71up2SzwFPrdZ02ZqnqPL8OEFEsD2Jx+ZskaidW6TGtfc4KMXlscpBXY1pRJ9Ldx1ma6USXHO8C7ElRZxD9jyUJwXp4hvgm8eivdAVMRBcNhEI53VYUX9/nWHXOIKmpdwR75mTpKuroEQVxm7aPTInOmIlBBXzWR9ox7W+LynRLwN7nooFteOiFfAkIfiR+K0xDG+znRig68/nRDHLZnLTC5bc+C5ZpJkC69NcbwTp18ZAGRG6gXFS/qLEyxpt7osyog6Dd5zAnE7JOcHOqr1E4gMZmucjwIuSgPMKbk/2s1ck+AELLp0553MdcLctsOejKAZ8IMTQ6LNmhaYK+M03lrycfACLIN5ENEQRnjNMnOM10vtBnorpB5f2BB5Tg5LXLu/KytaiDL5ghhm177ltmq7kmh+tKWUj7aQssxZH20rxHE8/ifAAOMxjvbvK+TbAAAAAElFTkSuQmCC"}}]);