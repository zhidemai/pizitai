(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-d583"],{NoVw:function(e,t,a){"use strict";a.r(t);var n=a("ViDN"),r=(a("KTTK"),a("utuE")),i=a("d8QR"),o={components:{CreateView:n.a,membersDep:r.a},data:function(){return{formList:[{label:"公告标题",field:"title"},{label:"通知部门",field:"dep",type:"plus"},{label:"开始时间",field:"start_time",type:"date"},{label:"结束时间",field:"end_time",type:"date"},{label:"公告正文",field:"content",type:"textarea"}],formData:{dep:{staff:[],dep:[]}},rules:{title:[{required:!0,message:"公告标题不能为空",trigger:"blur"},{max:50,message:"公告标题长度最多为50个字符",trigger:"blur"}],content:[{required:!0,message:"公告正文不能为空",trigger:"blur"}]},loading:!1}},methods:{onSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loading=!0,Object(i.a)({title:e.formData.title,content:e.formData.content,start_time:e.formData.start_time?new Date(e.formData.start_time).getTime()/1e3:"",end_time:e.formData.end_time?new Date(e.formData.end_time).getTime()/1e3:"",owner_structure_ids:e.formData.dep.dep.map(function(e){return e.id}),owner_user_ids:e.formData.dep.staff.map(function(e){return e.id})}).then(function(t){e.$message.success("新建公告成功"),1==e.$route.query.routerKey?e.$router.push("notice"):(t.data.create_time=(new Date).getTime(),e.$emit("onSubmit",t.data)),e.loading=!1}).catch(function(t){e.$message.error("新建公告失败"),e.loading=!1})})},close:function(){1==this.$route.query.routerKey?this.$router.go(-1):this.$emit("close")},popoverSubmit:function(e,t){this.$set(this.formData,"dep",{staff:e,dep:t})},deleteuser:function(e){this.formData.dep.staff.splice(e,1)},deleteDepuser:function(e){this.formData.dep.dep.splice(e,1)}}},s=(a("nBr4"),a("KHd+")),l=Object(s.a)(o,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("create-view",{attrs:{"body-style":{height:"100%"}}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"details-box"},[n("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[n("span",{staticClass:"text"},[e._v("新建公告")]),e._v(" "),n("img",{staticClass:"el-icon-close rt",attrs:{src:a("cjwK"),alt:""},on:{click:e.close}})]),e._v(" "),n("div",{staticClass:"content"},[n("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules}},e._l(e.formList,function(t,a){return n("el-form-item",{key:a,class:"el-form-item"+t.field,attrs:{label:t.label,prop:t.field}},["date"==t.type?[n("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.formData[t.field],callback:function(a){e.$set(e.formData,t.field,a)},expression:"formData[item.field]"}})]:"textarea"==t.type?[n("el-input",{attrs:{type:"textarea",autosize:{minRows:6},placeholder:"请输入内容"},model:{value:e.formData[t.field],callback:function(a){e.$set(e.formData,t.field,a)},expression:"formData[item.field]"}})]:"plus"==t.type?[n("members-dep",{attrs:{popoverDisplay:"block",title:"通知部门",userCheckedData:e.formData[t.field].staff,depCheckedData:e.formData[t.field].dep},on:{popoverSubmit:e.popoverSubmit}},[n("flexbox",{staticClass:"user-container",attrs:{slot:"membersDep",wrap:"wrap"},slot:"membersDep"},[e._l(e.formData[t.field].staff,function(t,a){return n("div",{key:"user"+a,staticClass:"user-item",on:{click:function(t){t.stopPropagation(),e.deleteuser(a)}}},[e._v(e._s(t.realname)+"\n                  "),n("i",{staticClass:"delete-icon el-icon-close"})])}),e._v(" "),e._l(e.formData[t.field].dep,function(t,a){return n("div",{key:"dep"+a,staticClass:"user-item",on:{click:function(t){t.stopPropagation(),e.deleteDepuser(a)}}},[e._v(e._s(t.name)+"\n                  "),n("i",{staticClass:"delete-icon el-icon-close"})])}),e._v(" "),n("div",{staticClass:"add-item"},[e._v("+添加")])],2)],1)]:n("el-input",{model:{value:e.formData[t.field],callback:function(a){e.$set(e.formData,t.field,a)},expression:"formData[item.field]"}})],2)}))],1),e._v(" "),n("div",{staticClass:"btn-box"},[n("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交")]),e._v(" "),n("el-button",{on:{click:e.close}},[e._v("取消")])],1)])])},[],!1,null,"29efe25a",null);l.options.__file="newDialog.vue";t.default=l.exports},bMj8:function(e,t,a){},d8QR:function(e,t,a){"use strict";a.d(t,"d",function(){return r}),a.d(t,"a",function(){return i}),a.d(t,"c",function(){return o}),a.d(t,"b",function(){return s}),a.d(t,"e",function(){return l});var n=a("t3Un");function r(e){return Object(n.a)({url:"oa/announcement/index",method:"post",data:e})}function i(e){return Object(n.a)({url:"oa/announcement/save",method:"post",data:e})}function o(e){return Object(n.a)({url:"oa/announcement/update",method:"post",data:e})}function s(e){return Object(n.a)({url:"oa/announcement/delete",method:"post",data:e})}function l(e){return Object(n.a)({url:"oa/announcement/read",method:"post",data:e})}},nBr4:function(e,t,a){"use strict";var n=a("bMj8");a.n(n).a}}]);