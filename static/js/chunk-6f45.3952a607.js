(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6f45"],{"11Cr":function(e,t,i){},"5j45":function(e,t,i){"use strict";var n=i("mX3o"),a=i("EgJF"),s=i("UcQx"),o={name:"relative-business",components:{CRMFullScreenDetail:function(){return Promise.all([i.e("chunk-682f"),i.e("chunk-a259"),i.e("chunk-11379")]).then(i.bind(null,"uMjE"))},CRMCreateView:a.default},computed:{},mixins:[n.a],data:function(){return{nopermission:!1,list:[],fieldList:[],tableHeight:"400px",showFullDetail:!1,isCreate:!1,businessId:"",formatterRules:{},createActionInfo:{type:"relative",crmType:this.crmType,data:{}}}},watch:{id:function(e){this.list=[],this.getDetail()}},props:{id:[String,Number],crmType:{type:String,default:""},detail:{type:Object,default:function(){return{}}}},mounted:function(){this.getDetail()},activated:function(){},deactivated:function(){},methods:{getFieldList:function(){function e(e){return e||""}this.fieldList.push({prop:"name",width:"200",label:"商机名称"}),this.fieldList.push({prop:"money",width:"200",label:"商机金额"}),this.fieldList.push({prop:"customer_id",width:"200",label:"客户名称"}),this.fieldList.push({prop:"type_id",width:"200",label:"商机状态组"}),this.fieldList.push({prop:"status_id",width:"200",label:"状态"}),this.formatterRules.customer_id={type:"crm",formatter:function(e){return e?e.name:""}},this.formatterRules.type_id={type:"crm",formatter:e},this.formatterRules.status_id={type:"crm",formatter:e}},getDetail:function(){var e=this;this.loading=!0,Object(s.c)({pageType:"all",customer_id:this.id}).then(function(t){0==e.fieldList.length&&e.getFieldList(),e.nopermission=!1,e.loading=!1,e.list=t.data.list}).catch(function(t){102==t.code&&(e.nopermission=!0),e.loading=!1})},fieldFormatter:function(e,t){var i=this.formatterRules[t.property];return i?"crm"===i.type?t.property?i.formatter(e[t.property+"_info"]):"":i.formatter(e[t.property]):e[t.property]},handleRowClick:function(e,t,i){this.businessId=e.business_id,this.showFullDetail=!0},headerRowStyle:function(e){e.row,e.column,e.rowIndex,e.columnIndex;return{textAlign:"center"}},cellStyle:function(e){e.row,e.column,e.rowIndex,e.columnIndex;return{textAlign:"center"}},createClick:function(){"contacts"==this.crmType?this.createActionInfo.data.customer=this.detail.customer_id_info:"customer"==this.crmType&&(this.createActionInfo.data.customer=this.detail),this.isCreate=!0},createSaveSuccess:function(){this.getDetail()}}},l=(i("iC4A"),i("KHd+")),r=Object(l.a)(o,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"empty",rawName:"v-empty",value:e.nopermission,expression:"nopermission"}],staticClass:"rc-cont",attrs:{"xs-empty-icon":"nopermission","xs-empty-text":"暂无权限"}},[i("flexbox",{staticClass:"rc-head",attrs:{direction:"row-reverse"}},[i("el-button",{staticClass:"rc-head-item",attrs:{type:"primary"},nativeOn:{click:function(t){return e.createClick(t)}}},[e._v("新建商机\n    ")])],1),e._v(" "),i("el-table",{staticStyle:{width:"100%",border:"1px solid #E6E6E6"},attrs:{data:e.list,height:e.tableHeight,stripe:"","header-cell-style":e.headerRowStyle,"cell-style":e.cellStyle},on:{"row-click":e.handleRowClick}},e._l(e.fieldList,function(t,n){return i("el-table-column",{key:n,attrs:{"show-overflow-tooltip":"",prop:t.prop,formatter:e.fieldFormatter,label:t.label}})})),e._v(" "),i("c-r-m-full-screen-detail",{attrs:{visible:e.showFullDetail,crmType:"business",id:e.businessId},on:{"update:visible":function(t){e.showFullDetail=t}}}),e._v(" "),e.isCreate?i("c-r-m-create-view",{attrs:{"crm-type":"business",action:e.createActionInfo},on:{"save-success":e.createSaveSuccess,"hiden-view":function(t){e.isCreate=!1}}}):e._e()],1)},[],!1,null,"70613359",null);r.options.__file="RelativeBusiness.vue";t.a=r.exports},"7Y1C":function(e,t,i){},JDYx:function(e,t,i){},MqOs:function(e,t,i){"use strict";var n=i("11Cr");i.n(n).a},R9qr:function(e,t,i){},akbi:function(e,t,i){"use strict";var n=i("R9qr");i.n(n).a},cYid:function(e,t,i){"use strict";var n=i("mX3o"),a=i("EgJF"),s=i("6zBA"),o={name:"relative-contract",components:{CRMFullScreenDetail:function(){return Promise.all([i.e("chunk-682f"),i.e("chunk-a259"),i.e("chunk-11379")]).then(i.bind(null,"uMjE"))},CRMCreateView:a.default},computed:{},mixins:[n.a],data:function(){return{nopermission:!1,list:[],fieldList:[],tableHeight:"400px",showFullDetail:!1,isCreate:!1,contractId:"",formatterRules:{},createActionInfo:{type:"relative",crmType:this.crmType,data:{}}}},watch:{id:function(e){this.list=[],this.getDetail()}},props:{id:[String,Number],crmType:{type:String,default:""},detail:{type:Object,default:function(){return{}}}},mounted:function(){this.getDetail()},activated:function(){},deactivated:function(){},methods:{getFieldList:function(){this.fieldList.push({prop:"num",width:"200",label:"合同编号"}),this.fieldList.push({prop:"name",width:"200",label:"合同名称"}),this.fieldList.push({prop:"customer_id",width:"200",label:"客户名称"}),this.fieldList.push({prop:"money",width:"200",label:"合同金额"}),this.fieldList.push({prop:"start_time",width:"200",label:"开始日期"}),this.fieldList.push({prop:"end_time",width:"200",label:"结束日期"}),this.formatterRules.customer_id={type:"crm",formatter:function(e){return e?e.name:""}}},getDetail:function(){var e=this;this.loading=!0,Object(s.c)({pageType:"all",customer_id:this.id}).then(function(t){0==e.fieldList.length&&e.getFieldList(),e.nopermission=!1,e.loading=!1,e.list=t.data.list}).catch(function(t){102==t.code&&(e.nopermission=!0),e.loading=!1})},fieldFormatter:function(e,t){var i=this.formatterRules[t.property];return i?"crm"===i.type?t.property?i.formatter(e[t.property+"_info"]):"":i.formatter(e[t.property]):e[t.property]},handleRowClick:function(e,t,i){this.contractId=e.contract_id,this.showFullDetail=!0},headerRowStyle:function(e){e.row,e.column,e.rowIndex,e.columnIndex;return{textAlign:"center"}},cellStyle:function(e){e.row,e.column,e.rowIndex,e.columnIndex;return{textAlign:"center"}},createClick:function(){"business"==this.crmType?(this.createActionInfo.data.customer=this.detail.customer_id_info,this.createActionInfo.data.business=this.detail):"customer"==this.crmType&&(this.createActionInfo.data.customer=this.detail),this.isCreate=!0},createSaveSuccess:function(){this.getDetail()}}},l=(i("cZ6F"),i("KHd+")),r=Object(l.a)(o,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"empty",rawName:"v-empty",value:e.nopermission,expression:"nopermission"}],staticClass:"rc-cont",attrs:{"xs-empty-icon":"nopermission","xs-empty-text":"暂无权限"}},[i("flexbox",{staticClass:"rc-head",attrs:{direction:"row-reverse"}},[i("el-button",{staticClass:"rc-head-item",attrs:{type:"primary"},nativeOn:{click:function(t){return e.createClick(t)}}},[e._v("新建合同\n    ")])],1),e._v(" "),i("el-table",{staticStyle:{width:"100%",border:"1px solid #E6E6E6"},attrs:{data:e.list,height:e.tableHeight,stripe:"","header-cell-style":e.headerRowStyle,"cell-style":e.cellStyle},on:{"row-click":e.handleRowClick}},e._l(e.fieldList,function(t,n){return i("el-table-column",{key:n,attrs:{"show-overflow-tooltip":"",prop:t.prop,formatter:e.fieldFormatter,label:t.label}})})),e._v(" "),i("c-r-m-full-screen-detail",{attrs:{visible:e.showFullDetail,crmType:"contract",id:e.contractId},on:{"update:visible":function(t){e.showFullDetail=t}}}),e._v(" "),e.isCreate?i("c-r-m-create-view",{attrs:{"crm-type":"contract",action:e.createActionInfo},on:{"save-success":e.createSaveSuccess,"hiden-view":function(t){e.isCreate=!1}}}):e._e()],1)},[],!1,null,"606c2462",null);r.options.__file="RelativeContract.vue";t.a=r.exports},cZ6F:function(e,t,i){"use strict";var n=i("JDYx");i.n(n).a},iC4A:function(e,t,i){"use strict";var n=i("ou4R");i.n(n).a},"k+tq":function(e,t,i){"use strict";var n=i("7Y1C");i.n(n).a},ou4R:function(e,t,i){},ppJE:function(e,t,i){"use strict";var n=i("vG5h"),a=i("Ew9n"),s=i("F03V"),o=i("UEWd"),l=i("QJC7"),r=i("8KPp"),c=i("gd5k"),u=i("aQg/"),d=i("y9lt"),m=i("KzkL"),p=i("7Qib"),h={name:"customer-follow",components:{MixAdd:o.a,RecordLog:l.a,JournalLog:r.a,ExamineLog:c.a,TaskLog:u.a,ScheduleLog:d.a},props:{id:[String,Number],crmType:{type:String,default:""}},watch:{},data:function(){return{sendLoading:!1,followTypes:[{type:"打电话",name:"打电话"},{type:"发邮件",name:"发邮件"},{type:"发短信",name:"发短信"},{type:"见面拜访",name:"见面拜访"},{type:"活动",name:"活动"}],followType:"打电话",next_time:"",is_event:!1,logType:"record",logTypes:[{type:"record",name:"跟进记录"},{type:"log",name:"日志"},{type:"examine",name:"审批"},{type:"task",name:"任务"},{type:"schedule",name:"日程"}]}},computed:{componentsName:function(){return"record"==this.logType?"RecordLog":"log"==this.logType?"JournalLog":"examine"==this.logType?"ExamineLog":"task"==this.logType?"TaskLog":"schedule"==this.logType?"ScheduleLog":""}},mounted:function(){},activated:function(){},deactivated:function(){},methods:{handleTypeDrop:function(e){this.followType=e},logTabsClick:function(e,t){this.logType=e.type},sendInfo:function(){this.$refs.mixadd.$emit("submit-info")},submitInfo:function(e){var t=this;if(!this.is_event||this.next_time){var i={};i.types="crm_"+this.crmType,i.types_id=this.id,i.content=e.content,i.category=this.followType;var n=e.images.map(function(e,t,i){return e.file_id}),a=e.files.map(function(e,t,i){return e.file_id}),s=e.business.map(function(e,t,i){return e.business_id}),o=e.contacts.map(function(e,t,i){return e.contacts_id});i.file_id=n.concat(a),i.business_ids=s,i.contacts_ids=o,this.next_time&&(i.is_event=this.is_event?1:0,i.next_time=Object(p.d)(this.next_time)),this.sendLoading=!0,Object(m.i)(i).then(function(e){t.sendLoading=!1,t.$message.success(e.data),t.$refs.mixadd.resetInfo(),t.is_event=!1,t.next_time="",t.$bus.emit("follow-log-refresh",{type:"record-log"})}).catch(function(){t.sendLoading=!1})}else this.$message.error("请选择下次联系时间")}}},f=(i("k+tq"),i("KHd+")),v=Object(f.a)(h,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"f-container"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.sendLoading,expression:"sendLoading"}]},[i("mix-add",{ref:"mixadd",attrs:{crmType:e.crmType,id:e.id,"show-relative-business":!0,"show-relative-contacts":!0},on:{"mixadd-info":e.submitInfo}}),e._v(" "),i("flexbox",{staticClass:"se-section"},[i("div",{staticClass:"se-name"},[e._v("记录类型")]),e._v(" "),i("el-dropdown",{staticStyle:{"margin-right":"20px"},attrs:{trigger:"click"},on:{command:e.handleTypeDrop}},[i("flexbox",{staticClass:"se-select"},[i("div",{staticClass:"se-select-name"},[e._v(e._s(e.followType?e.followType:"请选择"))]),e._v(" "),i("i",{staticClass:"el-icon-arrow-down el-icon--right",staticStyle:{color:"#ccc"}})]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.followTypes,function(t,n){return i("el-dropdown-item",{key:n,attrs:{command:t.type}},[e._v(e._s(t.name))])}))],1),e._v(" "),i("div",{staticClass:"se-name"},[e._v("下次联系时间")]),e._v(" "),i("el-date-picker",{staticClass:"se-datepicker",attrs:{type:"datetime",placeholder:"选择日期","value-format":"yyyy-MM-dd HH:mm:ss",editable:!1},model:{value:e.next_time,callback:function(t){e.next_time=t},expression:"next_time"}}),e._v(" "),i("el-checkbox",{model:{value:e.is_event,callback:function(t){e.is_event=t},expression:"is_event"}},[e._v("添加到日程提醒")]),e._v(" "),i("el-button",{staticClass:"se-send",attrs:{type:"primary"},nativeOn:{click:function(t){return e.sendInfo(t)}}},[e._v("发布")])],1)],1),e._v(" "),i("div",{staticClass:"log-cont"},[i("flexbox",{staticStyle:{"border-bottom":"1px solid #E6E6E6"}},e._l(e.logTypes,function(t,n){return i("flexbox",{key:n,staticStyle:{width:"auto"},nativeOn:{click:function(i){e.logTabsClick(t,n)}}},[i("div",{staticClass:"log-tabs-item",style:{color:e.logType==t.type?"#F18C70":"#777"}},[e._v(e._s(t.name))]),e._v(" "),e.logTypes.length-1!=n?i("div",{staticClass:"log-tabs-line"}):e._e()])})),e._v(" "),i("keep-alive",[i(e.componentsName,{tag:"component",attrs:{id:e.id,crmType:e.crmType}})],1)],1)])},[],!1,null,"3c6507fe",null);v.options.__file="CustomerFollow.vue";var y=v.exports,b=i("U05J"),g=i("mX3o"),w=i("EgJF"),_=i("qbf4"),C={name:"relative-contacts",components:{CRMFullScreenDetail:function(){return Promise.all([i.e("chunk-682f"),i.e("chunk-a259"),i.e("chunk-11379")]).then(i.bind(null,"uMjE"))},CRMCreateView:w.default},computed:{},mixins:[g.a],data:function(){return{nopermission:!1,list:[],fieldList:[],tableHeight:"400px",showFullDetail:!1,isCreate:!1,contactsId:"",createActionInfo:{type:"relative",crmType:this.crmType,data:{}}}},watch:{id:function(e){this.list=[],this.getDetail()}},props:{id:[String,Number],crmType:{type:String,default:""},detail:{type:Object,default:function(){return{}}}},mounted:function(){this.getDetail()},activated:function(){},deactivated:function(){},methods:{getFieldList:function(){this.fieldList.push({prop:"name",width:"200",label:"姓名"}),this.fieldList.push({prop:"mobile",width:"200",label:"手机"}),this.fieldList.push({prop:"post",width:"200",label:"职务"})},getDetail:function(){var e=this;this.loading=!0,Object(_.b)({pageType:"all",customer_id:this.id}).then(function(t){0==e.fieldList.length&&e.getFieldList(),e.nopermission=!1,e.loading=!1,e.list=t.data.list}).catch(function(t){102==t.code&&(e.nopermission=!0),e.loading=!1})},handleRowClick:function(e,t,i){this.contactsId=e.contacts_id,this.showFullDetail=!0},headerRowStyle:function(e){e.row,e.column,e.rowIndex,e.columnIndex;return{textAlign:"center"}},cellStyle:function(e){e.row,e.column,e.rowIndex,e.columnIndex;return{textAlign:"center"}},createClick:function(){"customer"==this.crmType&&(this.createActionInfo.data.customer=this.detail),this.isCreate=!0},createSaveSuccess:function(){this.getDetail()}}},x=(i("MqOs"),Object(f.a)(C,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"empty",rawName:"v-empty",value:e.nopermission,expression:"nopermission"}],staticClass:"rc-cont",attrs:{"xs-empty-icon":"nopermission","xs-empty-text":"暂无权限"}},[i("flexbox",{staticClass:"rc-head",attrs:{direction:"row-reverse"}},[i("el-button",{staticClass:"rc-head-item",attrs:{type:"primary"},nativeOn:{click:function(t){return e.createClick(t)}}},[e._v("新建联系人\n    ")])],1),e._v(" "),i("el-table",{staticStyle:{width:"100%",border:"1px solid #E6E6E6"},attrs:{data:e.list,height:e.tableHeight,stripe:"","header-cell-style":e.headerRowStyle,"cell-style":e.cellStyle},on:{"row-click":e.handleRowClick}},e._l(e.fieldList,function(e,t){return i("el-table-column",{key:t,attrs:{"show-overflow-tooltip":"",prop:e.prop,label:e.label}})})),e._v(" "),i("c-r-m-full-screen-detail",{attrs:{visible:e.showFullDetail,crmType:"contacts",id:e.contactsId},on:{"update:visible":function(t){e.showFullDetail=t}}}),e._v(" "),e.isCreate?i("c-r-m-create-view",{attrs:{"crm-type":"contacts",action:e.createActionInfo},on:{"save-success":e.createSaveSuccess,"hiden-view":function(t){e.isCreate=!1}}}):e._e()],1)},[],!1,null,"645f6170",null));x.options.__file="RelativeContacts.vue";var k=x.exports,D=i("5j45"),S=i("cYid"),T=i("+NTD"),L=i("C+sD"),R=i("8DbX"),I=i("DUlf"),F=(i("wd/R"),i("4+0Q")),N={name:"customer-detail",components:{SlideView:a.a,CustomerFollow:y,CRMDetailHead:s.a,CRMBaseInfo:b.a,RelativeContacts:k,RelativeBusiness:D.a,RelativeContract:S.a,RelativeReturnMoney:T.a,RelativeFiles:L.a,RelativeHandle:R.a,RelativeTeam:I.a,CRMCreateView:w.default},mixins:[F.a],props:{id:[String,Number],listenerIDs:{type:Array,default:function(){return["crm-main-container"]}},noListenerIDs:{type:Array,default:function(){return[]}},noListenerClass:{type:Array,default:function(){return["el-table__body"]}}},data:function(){return{loading:!1,crmType:"customer",detailData:{},headDetails:[{title:"客户级别",value:""},{title:"成交状态",value:""},{title:"负责人",value:""},{title:"更新时间",value:""}],tabCurrentName:"followlog",isCreate:!1}},computed:{tabName:function(){return"followlog"==this.tabCurrentName?"customer-follow":"basicinfo"==this.tabCurrentName?"c-r-m-base-info":"contacts"==this.tabCurrentName?"relative-contacts":"team"==this.tabCurrentName?"relative-team":"business"==this.tabCurrentName?"relative-business":"contract"==this.tabCurrentName?"relative-contract":"returnedmoney"==this.tabCurrentName?"relative-return-money":"file"==this.tabCurrentName?"relative-files":"operationlog"==this.tabCurrentName?"relative-handle":""},tabnames:function(){var e=[];return e.push({label:"跟进记录",name:"followlog"}),this.crm.customer&&this.crm.customer.read&&e.push({label:"基本信息",name:"basicinfo"}),this.crm.contacts&&this.crm.contacts.index&&e.push({label:"联系人",name:"contacts"}),e.push({label:"相关团队",name:"team"}),this.crm.business&&this.crm.business.index&&e.push({label:"商机",name:"business"}),this.crm.contract&&this.crm.contract.index&&e.push({label:"合同",name:"contract"}),this.crm.receivables&&this.crm.receivables.index&&e.push({label:"回款信息",name:"returnedmoney"}),e.push({label:"附件",name:"file"}),e.push({label:"操作记录",name:"operationlog"}),e}},mounted:function(){},methods:{getDetial:function(){var e=this;this.loading=!0,Object(n.j)({id:this.id}).then(function(t){e.loading=!1,e.detailData=t.data,e.headDetails[0].value=t.data.level,e.headDetails[1].value=t.data.deal_status,e.headDetails[2].value=e.isSeas?"- -":t.data.owner_user_id_info?t.data.owner_user_id_info.realname:"",e.headDetails[3].value=t.data.update_time}).catch(function(){e.loading=!1})},hideView:function(){this.$emit("hide-view")},handleClick:function(e,t){},editSaveSuccess:function(){this.$emit("handle",{type:"save-success"}),this.getDetial()}}},E=(i("akbi"),Object(f.a)(N,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("slide-view",{directives:[{name:"empty",rawName:"v-empty",value:!e.canShowDetail,expression:"!canShowDetail"}],attrs:{listenerIDs:e.listenerIDs,noListenerIDs:e.noListenerIDs,noListenerClass:e.noListenerClass,"body-style":{padding:0,height:"100%"}},on:{"side-close":e.hideView}},[e.canShowDetail?i("flexbox",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"d-container",attrs:{"xs-empty-icon":"nopermission","xs-empty-text":"暂无权限",direction:"column",align:"stretch"}},[i("c-r-m-detail-head",{attrs:{crmType:"customer",isSeas:e.isSeas,detail:e.detailData,headDetails:e.headDetails,id:e.id},on:{handle:e.detailHeadHandle,close:e.hideView}}),e._v(" "),i("div",{staticClass:"tabs"},[i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.tabCurrentName,callback:function(t){e.tabCurrentName=t},expression:"tabCurrentName"}},e._l(e.tabnames,function(e,t){return i("el-tab-pane",{key:t,attrs:{label:e.label,name:e.name}})}))],1),e._v(" "),i("div",{staticClass:"t-loading-content",attrs:{id:"follow-log-content"}},[i("keep-alive",[i(e.tabName,{tag:"component",attrs:{crmType:"customer",detail:e.detailData,id:e.id}})],1)],1)],1):e._e(),e._v(" "),e.isCreate?i("c-r-m-create-view",{attrs:{"crm-type":"customer",action:{type:"update",id:this.id}},on:{"save-success":e.editSaveSuccess,"hiden-view":function(t){e.isCreate=!1}}}):e._e()],1)},[],!1,null,"4104eb71",null));E.options.__file="CustomerDetail.vue";t.a=E.exports}}]);