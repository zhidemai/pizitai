(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7941"],{"0Ocb":function(t,e,n){"use strict";var a=n("Sk27");n.n(a).a},B2Fc:function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"d",function(){return s}),n.d(e,"f",function(){return l}),n.d(e,"e",function(){return u}),n.d(e,"c",function(){return r}),n.d(e,"b",function(){return c});var a=n("t3Un");function i(t){return Object(a.a)({url:"bi/achievement/statistics",method:"post",data:t})}function s(t){return Object(a.a)({url:"bi/product/statistics",method:"post",data:t})}function l(t){return Object(a.a)({url:"bi/receivables/statistics",method:"post",data:t})}function u(t){return Object(a.a)({url:"bi/receivables/statisticList",method:"post",data:t})}function r(t){return Object(a.a)({url:"bi/customer/statistics",method:"post",data:t})}function c(t){return Object(a.a)({url:"bi/business/funnel",method:"post",data:t})}},Q6wV:function(t,e,n){"use strict";n.r(e);var a=n("MT78"),i=n.n(a),s=n("KTTK"),l=n("7Qib"),u=n("UcQx"),r=n("B2Fc"),c=n("wd/R"),o=n.n(c),d={name:"funnel-statistics",components:{},data:function(){return{pickerOptions:{disabledDate:function(t){return t.getTime()>Date.now()}},loading:!1,dateSelect:[],structuresProps:{children:"children",label:"label",value:"id"},deptList:[],structuresSelectValue:"",userOptions:[],userSelectValue:"",businessOptions:[],businessStatusValue:"",list:[],fieldList:[{field:"status_name",name:"阶段"},{field:"money",name:"金额"},{field:"count",name:"商机数"}],funnelChart:null,funnelOption:null}},computed:{},mounted:function(){this.getDeptList();var t=o()(new Date).format("YYYY-MM-DD"),e=t.split("-"),n=e[0]+"-"+e[1]+"-01";this.dateSelect=[n,t],this.list=[],this.initFunnel()},methods:{getDeptList:function(){var t=this;this.loading=!0,Object(s.b)().then(function(e){t.deptList=e.data,t.loading=!1,e.data.length>0&&(t.structuresSelectValue=e.data[0].id,t.getUserList(),t.getBusinessStatusList())}).catch(function(){t.loading=!1})},structuresValueChange:function(t){this.userSelectValue="",this.userOptions=[],this.getUserList()},getUserList:function(){var t=this,e={};e.structure_id=this.structuresSelectValue,Object(s.j)(e).then(function(e){t.userOptions=e.data}).catch(function(){})},getBusinessStatusList:function(){var t=this;this.loading=!0,Object(u.g)({}).then(function(e){t.loading=!1,t.businessOptions=e.data,e.data.length>0&&(t.businessStatusValue=e.data[0].type_id,t.getData())}).catch(function(){t.loading=!1})},handleClick:function(t){"search"===t&&this.getData()},getData:function(){var t=this;this.loading=!0,Object(r.b)({start_time:Object(l.d)(this.dateSelect[0]),end_time:Object(l.d)(this.dateSelect[1]),structure_id:this.structuresSelectValue,user_id:this.userSelectValue,type_id:this.businessStatusValue}).then(function(e){t.loading=!1,t.list=e.data.list;for(var n=[],a=0;a<e.data.list.length;a++){var i=e.data.list[a];n.push({name:i.status_name+"("+i.count+")",value:i.money})}t.funnelOption.series[0].data=n,t.funnelOption.series[0].max=e.data.sum_money<1?1:e.data.sum_money,t.funnelChart.setOption(t.funnelOption,!0)}).catch(function(){t.loading=!1})},initFunnel:function(){var t=i.a.init(document.getElementById("funnelmain")),e={tooltip:{trigger:"item",formatter:"{b} <br/> 预测金额: {c}元"},toolbox:{feature:{saveAsImage:{}}},calculable:!0,grid:{left:0,right:0,bottom:0,top:0},series:[{name:"漏斗图",type:"funnel",left:"20%",width:"56%",sort:"none",gap:2,label:{normal:{show:!0,position:"right"},emphasis:{textStyle:{fontSize:20}}},labelLine:{normal:{length:20,lineStyle:{width:1,type:"solid"}}},itemStyle:{color:function(t){return["#6CA2FF","#6AC9D7","#72DCA2","#DBB375","#E164F7","#FF7474","#FFB270","#FECD51"][t.dataIndex%8]}},data:[]}]};t.setOption(e,!0),this.funnelOption=e,this.funnelChart=t}}},f=(n("0Ocb"),n("KHd+")),h=Object(f.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"main-container"},[n("div",{staticClass:"handle-bar"},[n("el-date-picker",{attrs:{type:"daterange",clearable:!1,"range-separator":"-",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","picker-options":t.pickerOptions,"start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.dateSelect,callback:function(e){t.dateSelect=e},expression:"dateSelect"}}),t._v(" "),n("el-select",{attrs:{placeholder:"选择部门"},on:{change:t.structuresValueChange},model:{value:t.structuresSelectValue,callback:function(e){t.structuresSelectValue=e},expression:"structuresSelectValue"}},t._l(t.deptList,function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),t._v(" "),n("el-select",{attrs:{clearable:!0,placeholder:"选择员工"},model:{value:t.userSelectValue,callback:function(e){t.userSelectValue=e},expression:"userSelectValue"}},t._l(t.userOptions,function(t){return n("el-option",{key:t.id,attrs:{label:t.realname,value:t.id}})})),t._v(" "),n("el-select",{attrs:{placeholder:"商机组"},model:{value:t.businessStatusValue,callback:function(e){t.businessStatusValue=e},expression:"businessStatusValue"}},t._l(t.businessOptions,function(t){return n("el-option",{key:t.type_id,attrs:{label:t.name,value:t.type_id}})})),t._v(" "),n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(e){t.handleClick("search")}}},[t._v("搜索")])],1),t._v(" "),n("div",{staticClass:"content"},[n("flexbox",[n("flexbox-item",[n("div",{staticClass:"funnel",attrs:{id:"funnelmain"}})]),t._v(" "),n("flexbox-item",[n("el-table",{attrs:{data:t.list,height:"300",stripe:"","highlight-current-row":""}},t._l(t.fieldList,function(t,e){return n("el-table-column",{key:e,attrs:{align:"center","header-align":"center","show-overflow-tooltip":"",prop:t.field,label:t.name}})}))],1)],1)],1)])},[],!1,null,"0109e72a",null);h.options.__file="FunnelStatistics.vue";e.default=h.exports},Sk27:function(t,e,n){}}]);